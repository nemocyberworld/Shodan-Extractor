<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Shodan Juicy Info Extractor</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col items-center p-6">
  <h1 class="text-3xl font-bold text-teal-400 mb-4">üîç Shodan Juicy Info Extractor</h1>

  <textarea id="input" class="w-full max-w-5xl h-64 p-3 bg-gray-800 text-sm rounded-lg border border-gray-600 focus:outline-none focus:ring-2 focus:ring-teal-500 resize-y mb-4" placeholder="üìã Paste full Shodan HTML or text content here..."></textarea>

  <div class="flex space-x-2 mb-4 flex-wrap">
    <button onclick="extractInfo()" class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-2 rounded-lg transition">Extract üîì</button>
    <button onclick="exportXLS()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg transition">Export XLS üìä</button>
    <button onclick="importXLS()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-2 rounded-lg transition">Import XLS üì•</button>
    <button onclick="saveProgress()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded-lg transition">Save Progress üíæ</button>
    <button onclick="loadProgress()" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg transition">Load Progress üìÇ</button>
    <button onclick="clearProgress()" class="bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-lg transition">Clear Progress ‚ùå</button>
  </div>

  <div id="summary" class="mt-2 text-gray-400 text-sm"></div>

  <div class="w-full overflow-x-auto mt-4">
    <table class="min-w-full max-w-7xl divide-y divide-gray-700 text-sm text-left" id="resultsTable">
      <thead class="bg-gray-800 text-teal-300">
        <tr>
          <th class="px-3 py-2">#</th>
          <th class="px-3 py-2">IP</th>
          <th class="px-3 py-2">Hostname</th>
          <th class="px-3 py-2">Org</th>
          <th class="px-3 py-2">Location</th>
          <th class="px-3 py-2">Cert CN</th>
          <th class="px-3 py-2">Cert Subject Org</th>
          <th class="px-3 py-2">Cert Issuer Org</th>
          <th class="px-3 py-2">TLS</th>
          <th class="px-3 py-2">HTTP</th>
          <th class="px-3 py-2">HTTP Server</th>
          <th class="px-3 py-2">SMTP Server</th>
          <th class="px-3 py-2">Redirect</th>
          <th class="px-3 py-2">Errors</th>
        </tr>
      </thead>
      <tbody id="resultsBody" class="bg-gray-900 divide-y divide-gray-800">
        <!-- dynamic rows -->
      </tbody>
    </table>
  </div>

  <footer class="mt-10 text-gray-500 text-sm">Made with ‚ù§Ô∏è for Bug Bounty Hunters</footer>

  <input type="file" id="fileInput" accept=".xls,.xlsx" style="display:none" />

  <script>
    let results = [];

    function extractInfo() {
      const raw = document.getElementById('input').value;
      const body = document.getElementById('resultsBody');
      const summary = document.getElementById('summary');
      body.innerHTML = "";
      summary.innerHTML = "";
      results = [];

      // Split by lines that start with date or IP (to chunk each host info)
      const chunks = raw.split(/\n(?=\d{4}-\d{2}-\d{2}T|\d{1,3}(?:\.\d{1,3}){3})/);

      chunks.forEach((chunk) => {
        const ipMatch = chunk.match(/\b\d{1,3}(?:\.\d{1,3}){3}\b/);
        const ip = ipMatch ? ipMatch[0] : "Unknown";

        const hostnameMatch = chunk.match(/\b([a-z0-9.-]+\.[a-z]{2,})(?=\s|$)/i);
        const hostname = hostnameMatch ? hostnameMatch[1] : "-";

        const orgMatch = chunk.match(/Amazon\.com, Inc\.|Amazon Technologies Inc\.|Microsoft Corporation|Google LLC|DigitalOcean, LLC|OVH SAS|A100 ROW GmbH|COMODO CA Limited|Cloudflare/i);
        const org = orgMatch ? orgMatch[0] : "-";

        const locationMatch = chunk.match(/United States|Germany|France|Netherlands|Japan|India|Brazil|Australia|UAE|United Arab Emirates/i);
        let location = locationMatch ? locationMatch[0] : "-";

        const cityRegionMatch = chunk.match(new RegExp(location + '\\s*([A-Za-z ,]+)', 'i'));
        if (cityRegionMatch && cityRegionMatch[1]) {
          location = location + cityRegionMatch[1].trim();
        }

        const certCNMatch = chunk.match(/Common Name:\s*([^\r\n]+)/i);
        const certCN = certCNMatch ? certCNMatch[1].trim() : "-";

        // New: Cert Subject Organization
        const certSubjOrgMatch = chunk.match(/Subject:\s*.*?O=([^,\r\n]+)/i);
        const certSubjectOrg = certSubjOrgMatch ? certSubjOrgMatch[1].trim() : "-";

        // New: Cert Issuer Organization
        const certIssuerOrgMatch = chunk.match(/Issuer:\s*.*?O=([^,\r\n]+)/i);
        const certIssuerOrg = certIssuerOrgMatch ? certIssuerOrgMatch[1].trim() : "-";

        const tlsMatch = chunk.match(/Supported SSL Versions:[\s\S]*?(TLSv1\.\d(?:,\s*TLSv1\.\d)*)/i);
        const tls = tlsMatch ? tlsMatch[1].trim() : "-";

        const httpMatch = chunk.match(/HTTP\/1\.\d\s+(\d{3})\s+([^\r\n]+)/i);
        const httpCode = httpMatch ? httpMatch[1] : "-";
        const httpMsg = httpMatch ? httpMatch[2] : "-";
        const http = `${httpCode} ${httpMsg}`;

        // New: HTTP Server header (Server: ...)
        const httpServerMatch = chunk.match(/Server:\s*([^\r\n]+)/i);
        const httpServer = httpServerMatch ? httpServerMatch[1].trim() : "-";

        // New: SMTP Server Banner (lines starting with 220 or 250 with server info)
        const smtpMatch = chunk.match(/^(220|250)\s.*?([^\s]+(?:\sESMTP\s[^\r\n]+)?)/m);
        const smtpServer = smtpMatch ? smtpMatch[0].trim() : "-";

        const sslErrorMatch = chunk.match(/SSL Error:\s*([^\r\n]+)/i);
        const sslError = sslErrorMatch ? sslErrorMatch[1].trim() : "";

        const redirectMatch = chunk.match(/Location:\s*(https?:\/\/[^\s\r\n]+)/i);
        const redirectURL = redirectMatch ? redirectMatch[1].trim() : "-";

        const errorDisplay = sslError ? `<span class="text-red-400">${sslError}</span>` : "-";

        results.push({
          ip,
          hostname,
          org,
          location,
          certCN,
          certSubjectOrg,
          certIssuerOrg,
          tls,
          http,
          httpServer,
          smtpServer,
          redirect: redirectURL,
          errors: errorDisplay
        });
      });

      results.sort((a, b) => a.ip.localeCompare(b.ip));

      renderResults();

      summary.innerHTML = `‚úÖ Extracted <span class="text-teal-300 font-bold">${results.length}</span> hosts`;
    }

    function exportXLS() {
      if (results.length === 0) {
        alert("No data to export. Please extract info first.");
        return;
      }

      const data = [
        ["#", "IP", "Hostname", "Org", "Location", "Cert CN", "Cert Subject Org", "Cert Issuer Org", "TLS", "HTTP", "HTTP Server", "SMTP Server", "Redirect", "Errors"]
      ];

      results.forEach((r, i) => {
        data.push([
          i + 1,
          r.ip,
          r.hostname,
          r.org,
          r.location,
          r.certCN,
          r.certSubjectOrg,
          r.certIssuerOrg,
          r.tls,
          r.http,
          r.httpServer,
          r.smtpServer,
          r.redirect,
          r.errors.replace(/<\/?[^>]+(>|$)/g, "")
        ]);
      });

      const ws = XLSX.utils.aoa_to_sheet(data);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Results");
      XLSX.writeFile(wb, "shodan-juicy-info.xlsx");
    }

    function importXLS() {
      const fileInput = document.getElementById('fileInput');
      fileInput.click();
      fileInput.onchange = () => {
        const file = fileInput.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const firstSheetName = workbook.SheetNames[0];
          const worksheet = workbook.Sheets[firstSheetName];
          const rows = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

          if (rows.length < 2) {
            alert("Spreadsheet seems empty or invalid.");
            return;
          }

          results = [];
          for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            if (row.length < 14) continue;
            results.push({
              ip: row[1] || "-",
              hostname: row[2] || "-",
              org: row[3] || "-",
              location: row[4] || "-",
              certCN: row[5] || "-",
              certSubjectOrg: row[6] || "-",
              certIssuerOrg: row[7] || "-",
              tls: row[8] || "-",
              http: row[9] || "-",
              httpServer: row[10] || "-",
              smtpServer: row[11] || "-",
              redirect: row[12] || "-",
              errors: row[13] || "-"
            });
          }

          renderResults();
          document.getElementById('summary').innerHTML = `üì• Loaded ${results.length} hosts from XLS`;
          fileInput.value = "";
        };
        reader.readAsArrayBuffer(file);
      };
    }

    function renderResults() {
      const body = document.getElementById('resultsBody');
      body.innerHTML = "";

      results.forEach((r, i) => {
        const tr = document.createElement('tr');
        tr.className = i % 2 === 0 ? "bg-gray-900" : "bg-gray-800";

        tr.innerHTML = `
          <td class="px-3 py-1 whitespace-nowrap">${i + 1}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.ip}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.hostname}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.org}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.location}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.certCN}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.certSubjectOrg}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.certIssuerOrg}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.tls}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.http}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.httpServer}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.smtpServer}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.redirect}</td>
          <td class="px-3 py-1 whitespace-nowrap">${r.errors}</td>
        `;

        body.appendChild(tr);
      });
    }

    function saveProgress() {
      if (results.length === 0) {
        alert("No data to save.");
        return;
      }
      localStorage.setItem('shodanResults', JSON.stringify(results));
      alert("Progress saved to localStorage.");
    }

    function loadProgress() {
      const saved = localStorage.getItem('shodanResults');
      if (!saved) {
        alert("No saved progress found.");
        return;
      }
      results = JSON.parse(saved);
      renderResults();
      document.getElementById('summary').innerHTML = `üìÇ Loaded ${results.length} hosts from localStorage`;
    }

    function clearProgress() {
      if (confirm("Are you sure you want to clear all saved data?")) {
        localStorage.removeItem('shodanResults');
        results = [];
        document.getElementById('resultsBody').innerHTML = "";
        document.getElementById('summary').innerHTML = "üóëÔ∏è Cleared saved data.";
      }
    }
  </script>
</body>
</html>
